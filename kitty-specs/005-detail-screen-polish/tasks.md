---
description: "Work package task list for detail screen polish fixes"
---

# Work Packages: Detail Screen Polish

**Inputs**: Design documents from `/kitty-specs/005-detail-screen-polish/`
**Prerequisites**: plan.md (refactoring strategy), spec.md (user stories & acceptance scenarios), research.md (component analysis), quickstart.md (implementation patterns)

**Tests**: Visual QA only (manual verification against acceptance scenarios). No automated test requirements.

**Organization**: 19 fine-grained subtasks (`T001`-`T019`) roll up into 4 work packages (`WP01`-`WP04`). Each work package is independently deliverable and testable.

**Prompt Files**: Each work package references a matching prompt file in `/tasks/` generated by `/spec-kitty.tasks`. Treat this file as the high-level checklist; deep implementation detail lives in the prompt files.

## Subtask Format: `[Txxx] [P?] Description`
- **[P]** indicates the subtask can proceed in parallel (different files/components).
- Includes precise file paths from React Native project structure.

## Path Conventions
- **Screens**: `app/` directory (Expo Router file-based routing)
- **Components**: `src/components/`
- **Hooks**: `src/hooks/`
- **Services**: `src/services/`

---

## Work Package WP01: SharedItemsList Refactoring (Priority: P0)

**Goal**: Refactor SharedItemsList component to support both standalone (full-page) and embedded (detail screen section) usage modes with configurable bulk actions.
**Independent Test**: SharedItemsList renders correctly in both standalone mode (project items tab) and embedded mode (test in transaction detail). Bulk selection toggle correctly deselects when all items are selected.
**Prompt**: `/tasks/WP01-shared-items-list-refactoring.md`
**Estimated Size**: ~300 lines

### Included Subtasks
- [x] T001 Add embedded mode configuration props to SharedItemsList (`src/components/SharedItemsList.tsx`)
- [x] T002 Extract BulkSelectionBar into separate component (`src/components/BulkSelectionBar.tsx`)
- [x] T003 Fix bulk selection toggle logic to deselect when all selected
- [x] T004 Update SharedItemsList conditional rendering based on embedded mode

### Implementation Notes
This is foundation work that enables all subsequent work packages. The refactoring must maintain backward compatibility for existing standalone usage in project/inventory tabs while adding new embedded mode for detail screens.

Key changes:
1. Add optional props: `embedded`, `manager`, `items`, `bulkActions`, `onItemPress`, `getItemMenuItems`
2. Extract sticky bottom bar UI into reusable BulkSelectionBar component
3. Fix toggle logic: if all selected → deselect, else → select all
4. When `embedded={true}`: hide top controls, use external state, render provided items

### Parallel Opportunities
All subtasks in this WP are sequential (T001 enables T002-T004).

### Dependencies
None (starting package).

### Risks & Mitigations
- **Risk**: Breaking existing standalone usage in project/inventory tabs
- **Mitigation**: Maintain strict backward compatibility (embedded defaults to false, all new props optional)
- **Risk**: Component becomes too complex with dual modes
- **Mitigation**: Use clear conditional logic, consider extracting shared hooks if needed

---

## Work Package WP02: Transaction Detail Screen Polish (Priority: P1)

**Goal**: Apply SharedItemsList refactoring to transaction detail, merge tax into details section, normalize spacing, fix duplicate titles.
**Independent Test**: Transaction detail screen shows grouped item cards with selector circles and status badges, has single "DETAILS" section (tax merged), consistent 4px section spacing, no duplicate titles.
**Prompt**: `/tasks/WP02-transaction-detail-screen-polish.md`
**Estimated Size**: ~320 lines

### Included Subtasks
- [ ] T005 Replace ItemsSection with SharedItemsList in transaction detail (`app/transactions/[id]/index.tsx`)
- [ ] T006 Merge tax/itemization rows into Details section
- [ ] T007 Normalize section spacing (gap: 4px with section wrappers)
- [ ] T008 Fix duplicate section titles (use Card not TitledCard)

### Implementation Notes
This WP applies the refactored SharedItemsList to transaction detail and fixes structural issues.

Key changes:
1. Import SharedItemsList and useItemsManager
2. Define transaction-specific bulk actions: Set Space, Set Status, Set SKU, Remove, Delete
3. Move tax rows (Subtotal, Tax rate, Tax amount) into Details section using conditional spread
4. Remove "TAX & ITEMIZATION" section header
5. Wrap each section's header + content in View with `gap: 12`, set contentContainerStyle.gap: 4
6. Replace TitledCard with Card inside collapsible sections

### Parallel Opportunities
None - subtasks are sequential within this screen.

### Dependencies
- **Depends on WP01** (SharedItemsList refactoring must be complete)

### Risks & Mitigations
- **Risk**: Tax rows not conditional (shown when no tax data)
- **Mitigation**: Use `...(transaction.itemizationEnabled ? [...taxRows] : [])`
- **Risk**: Section spacing affects collapse/expand transitions
- **Mitigation**: Test all sections can collapse/expand smoothly

---

## Work Package WP03: Item Detail Screen Polish (Priority: P1)

**Goal**: Fix item detail hero card to show transaction as "Source - $Amount" with space info, move "Move Item" to kebab menu, normalize spacing, fix duplicate titles.
**Independent Test**: Item detail hero card displays linked transaction as "Amazon - $149.99" (tappable), shows space when assigned, uses consistent info row styling. "Move Item" accessible from kebab menu only (not inline). Section spacing is 4px, no duplicate titles.
**Prompt**: `/tasks/WP03-item-detail-screen-polish.md`
**Estimated Size**: ~420 lines

### Included Subtasks
- [x] T009 Update item detail hero card with linked transaction display (`app/items/[id]/index.tsx`)
- [x] T010 Add space info row to item detail hero card
- [x] T011 Handle edge cases in hero card (deleted transaction, no data, no name)
- [x] T012 Move "Move Item" to kebab menu with bottom sheet
- [x] T013 Normalize section spacing (gap: 4px with section wrappers)
- [x] T014 Fix duplicate section titles (use Card not TitledCard)

### Implementation Notes
This WP has the most individual fixes (6 subtasks) but they're all related to the same screen and can be completed together.

Key changes:
1. Load transaction data with useTransactionById (cache-first)
2. Format as "Source - $Amount", render as tappable text with `color: theme.colors.primary`
3. Load space data with useSpaceById, show "Space: Name" when present
4. Handle edge cases: deleted transaction → "[Deleted]", no transaction → "None", no space → omit
5. Remove inline Move Item section, add to kebab menu, render in FormBottomSheet
6. Update section gap from 18 to 4, wrap sections with View (gap: 12)
7. Replace TitledCard with Card in collapsible sections

### Parallel Opportunities
T009-T011 (hero card changes) can proceed independently from T012 (move to kebab) and T013-T014 (spacing/titles).

### Dependencies
- **Depends on WP01** (not directly, but follows pattern established in WP02)

### Risks & Mitigations
- **Risk**: Transaction/space data not loaded (causes blank display)
- **Mitigation**: Use cache-first mode, handle loading states gracefully
- **Risk**: Edge case handling incomplete (deleted transactions show broken state)
- **Mitigation**: Test all edge cases explicitly (see spec edge cases section)

---

## Work Package WP04: Space Detail Screen Polish & Cleanup (Priority: P1)

**Goal**: Apply SharedItemsList to space detail, update default expanded sections, normalize spacing, fix duplicate titles, mark ItemsSection as deprecated.
**Independent Test**: Space detail shows grouped item cards with proper bulk UI, only images section expanded by default, section spacing is 4px, no duplicate titles. ItemsSection marked deprecated with JSDoc comment.
**Prompt**: `/tasks/WP04-space-detail-screen-polish.md`
**Estimated Size**: ~340 lines

### Included Subtasks
- [ ] T015 Replace ItemsSection with SharedItemsList in space detail (`src/components/SpaceDetailContent.tsx` or `app/project/[projectId]/spaces/[spaceId].tsx`)
- [ ] T016 Update space detail default expanded sections (only images)
- [ ] T017 Normalize section spacing (gap: 4px with section wrappers)
- [ ] T018 Fix duplicate section titles (use Card not TitledCard)
- [ ] T019 Mark ItemsSection as deprecated (`src/components/ItemsSection.tsx`)

### Implementation Notes
This WP completes the detail screen refactoring by applying SharedItemsList to the final screen (space detail) and formally deprecating the old ItemsSection component.

Key changes:
1. Import SharedItemsList and useItemsManager
2. Define space-specific bulk actions: Move, Remove, Delete
3. Update initial collapsed sections state: images (false), items (true), notes (true), checklists (true)
4. Update section gap from 20 to 4, wrap sections with View (gap: 12)
5. Replace TitledCard with Card in collapsible sections
6. Add JSDoc deprecation comment to ItemsSection with migration guide reference

### Parallel Opportunities
T015-T018 (space detail changes) are sequential. T019 (deprecation comment) can be done independently.

### Dependencies
- **Depends on WP01** (SharedItemsList refactoring must be complete)
- **Best done after WP02-WP03** (to validate pattern consistency across all three screens)

### Risks & Mitigations
- **Risk**: Space detail has different component structure (may not use same patterns)
- **Mitigation**: Research.md confirms it uses SectionList like other detail screens
- **Risk**: ItemsSection still imported elsewhere
- **Mitigation**: Only mark as deprecated, do NOT delete (removal is future work)

---

## Dependency & Execution Summary

- **Sequence**: WP01 → WP02/WP03/WP04 (WP02-WP04 can run in any order after WP01)
- **Parallelization**: After WP01 completes, WP02, WP03, WP04 are independent (different screens/files)
- **MVP Scope**: All 4 work packages constitute the complete feature (no MVP subset)

**Recommended Order**:
1. WP01 (foundation - enables all others)
2. WP02 (transaction detail - validates pattern on first screen)
3. WP03 (item detail - most complex with 6 subtasks)
4. WP04 (space detail + cleanup - completes feature)

---

## Subtask Index (Reference)

| Subtask ID | Summary | Work Package | Priority | Parallel? |
|------------|---------|--------------|----------|-----------|
| T001 | Add embedded mode props to SharedItemsList | WP01 | P0 | No |
| T002 | Extract BulkSelectionBar component | WP01 | P0 | No |
| T003 | Fix bulk selection toggle logic | WP01 | P0 | No |
| T004 | Update conditional rendering for embedded mode | WP01 | P0 | No |
| T005 | Replace ItemsSection in transaction detail | WP02 | P1 | No |
| T006 | Merge tax into Details section | WP02 | P1 | No |
| T007 | Normalize section spacing (transaction) | WP02 | P1 | No |
| T008 | Fix duplicate titles (transaction) | WP02 | P1 | No |
| T009 | Update hero card with transaction link | WP03 | P1 | Yes |
| T010 | Add space info to hero card | WP03 | P1 | Yes |
| T011 | Handle hero card edge cases | WP03 | P1 | Yes |
| T012 | Move "Move Item" to kebab menu | WP03 | P1 | Yes |
| T013 | Normalize section spacing (item) | WP03 | P1 | No |
| T014 | Fix duplicate titles (item) | WP03 | P1 | No |
| T015 | Replace ItemsSection in space detail | WP04 | P1 | No |
| T016 | Update default expanded sections | WP04 | P1 | No |
| T017 | Normalize section spacing (space) | WP04 | P1 | No |
| T018 | Fix duplicate titles (space) | WP04 | P1 | No |
| T019 | Mark ItemsSection as deprecated | WP04 | P1 | Yes |

---

## Testing & Validation Strategy

**No automated tests required** - this is a UI polish feature with visual acceptance criteria.

**Visual QA Process** (manual):
1. Capture "before" screenshots of all three detail screens
2. Verify each acceptance scenario from spec.md against implementation
3. Compare detail screen item lists to project items tab (reference implementation)
4. Validate all edge cases (empty lists, deleted transactions, no descriptions, etc.)
5. Verify offline-first patterns preserved (no UI blocking on server)

**Acceptance Checklist** (per spec.md success criteria):
- [ ] SC-001: Item lists match project items tab (grouped cards, selector, badges, bottom bar)
- [ ] SC-002: Bulk select toggle deselects when all selected
- [ ] SC-003: Transaction detail has single "DETAILS" section
- [ ] SC-004: Item detail shows "Source - $Amount" with proper styling
- [ ] SC-005: Zero duplicate section titles across all screens
- [ ] SC-006: Consistent 4px section spacing across all screens
- [ ] SC-007: "Move Item" only in kebab menu
- [ ] SC-008: Space detail defaults to only images expanded
- [ ] SC-009: ItemsSection no longer imported/used (marked deprecated)
- [ ] SC-010: All functionality preserved (navigation, offline-first, media, bulk ops)

**Review Command**: `/spec-kitty.review WP##` after each work package completes

---

> This tasks.md file provides the high-level structure. Detailed implementation guidance for each work package lives in the corresponding prompt file in `/tasks/WP##-*.md`.
